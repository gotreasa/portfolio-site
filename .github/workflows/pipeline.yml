name: Pipeline

env:
  NODE_VERSION: 18.18
  HUGO_VERSION: 0.136.4

permissions:
  checks: write
  contents: read
  pull-requests: read

on:
  - push
  - pull_request
  - workflow_dispatch

jobs:
  commitlint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@main
        with:
          fetch-depth: 0
      - uses: wagoid/commitlint-github-action@master

  prettier-verify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the code
        uses: actions/checkout@main
      - uses: actions/setup-node@main
        with:
          node-version: '${{ env.NODE_VERSION }}'
      - run: npm install
      - name: Prettify the code
        run: npm run prettier:verify

  eslint-verify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the code
        uses: actions/checkout@main
      - uses: actions/setup-node@main
        with:
          node-version: '${{ env.NODE_VERSION }}'
      - run: npm install
      - name: Prettify the code
        run: npm run lint:verify

  # Check for any broken links
  markdown-link-check:
    runs-on: ubuntu-latest
    steps:
      # checkout to latest commit
      - uses: actions/checkout@master
      # run markdown linter
      - uses: gaurav-nelson/github-action-markdown-link-check@1.0.15

  hugo-build:
    needs: [commitlint, prettier-verify, eslint-verify, markdown-link-check]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the code
        uses: actions/checkout@main
      - name: Setup hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: '${{ env.HUGO_VERSION }}'
          extended: true
      - uses: actions/setup-go@v5
        with:
          go-version: '1.22'
          cache: false
      - name: Build
        run: |
          npm install 
          npm run build
